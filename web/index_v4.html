<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NextChapter Outplacement — Your Next Chapter Starts Here</title>
  <meta name="description" content="Empathic, efficient outplacement support for mid and late‑career professionals. Structure, tools, and coaching aligned to your JTBD journey." />
  <style>
    :root {
      --bg: #0e1116;
      --surface: #141922;
      --muted: #94a3b8;
      --text: #e6eef8;
      --accent: #007bff;
      --accent-strong: #007bff;
      --card: #1b2330;
      --card-border: #263043;
      --warning: #fbbf24;
      --danger: #f87171;
      --focus: #93c5fd;
      --shadow: 0 10px 30px rgba(0,0,0,.4);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f7fafc;
        --surface: #ffffff;
        --muted: #475569;
        --text: #0f172a;
        --card: #ffffff;
        --card-border: #e2e8f0;
        --shadow: 0 10px 30px rgba(2, 6, 23, .08);
      }
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font: 16px/1.5 ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
        background: radial-gradient(1200px 600px at 70% -10%, rgba(0, 123, 255, 0.15), transparent 60%),
                    radial-gradient(800px 400px at 0% 0%, rgba(0, 123, 255, 0.12), transparent 60%),
                  var(--bg);
    }
    .container { width: min(1120px, 92%); margin: 0 auto; }

    /* Accessibility */
    .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip-link:focus { position: fixed; left: 16px; top: 16px; width: auto; height: auto; padding: .6rem .9rem; background: var(--surface); color: var(--text); border: 2px solid var(--focus); border-radius: .5rem; z-index: 1000; }

    /* Header */
    .site-header { position: sticky; top: 0; z-index: 50; backdrop-filter: saturate(180%) blur(10px); background: color-mix(in lab, var(--bg), transparent 30%); border-bottom: 1px solid var(--card-border); }
    .nav { display: flex; align-items: center; justify-content: space-between; padding: .9rem 0; }
    .logo { display: inline-flex; gap: .6rem; align-items: center; font-weight: 800; letter-spacing: .3px; color: var(--text); text-decoration: none; }
    .logo-mark { width: 1.9rem; height: 1.9rem; border-radius: .6rem; display: inline-grid; place-items: center; background: linear-gradient(135deg, var(--accent), var(--accent-strong)); color: #0b1320; font-weight: 900; }
    nav[aria-label="Primary"] ul { display: flex; gap: 1rem; align-items: center; list-style: none; margin: 0; padding: 0; }
    nav[aria-label="Primary"] a { text-decoration: none; color: var(--text); opacity: .88; padding: .5rem .7rem; border-radius: .5rem; }
    nav[aria-label="Primary"] a:hover { background: color-mix(in lab, var(--card), transparent 40%); opacity: 1; }

      .btn { display: inline-flex; align-items: center; justify-content: center; gap: .5rem; padding: .8rem 1.1rem; border-radius: 999px; border: 2px solid var(--accent); background: #fff; color: var(--accent); text-decoration: none; font-weight: 650; box-shadow: var(--shadow); }
      .btn:focus-visible { outline: none; box-shadow: 0 0 0 3px var(--focus), var(--shadow); }
      .btn-primary { background: #fff; color: var(--accent); border-color: var(--accent); }
      .btn-outline { background: #fff; border-color: var(--accent); }

    /* Global card default */
    .card { background: var(--card); border: 1px solid var(--card-border); border-radius: 1rem; padding: 1rem; }
    .card h3 { margin-top: 0; }
    .card p { color: var(--muted); }

    /* Hero */
    .hero { padding: clamp(2rem, 5vw, 4rem) 0 2rem; }
    .hero-grid { display: grid; grid-template-columns: 1.15fr .85fr; gap: clamp(1rem, 4vw, 2.5rem); align-items: center; }
    .hero h1 { font-size: clamp(2rem, 4vw, 3rem); line-height: 1.15; margin: 0 0 .75rem; }
    .hero p { font-size: clamp(1rem, 1.5vw, 1.125rem); color: var(--muted); margin: 0 0 1.2rem; }
    .actions { display: flex; gap: .8rem; flex-wrap: wrap; }
    .kpi { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: .9rem; margin-top: 1.2rem; }
    .kpi .card { text-align: center; }
    .kpi .card .num { font-weight: 800; font-size: 1.4rem; }
    .kpi .card .lbl { color: var(--muted); font-size: .9rem; }

    .hero-art { display: grid; gap: .8rem; }
    .hero-art .panel { background: var(--card); border: 1px solid var(--card-border); border-radius: 1rem; padding: 1rem; box-shadow: var(--shadow); }
    .hero-art .panel h3 { margin: 0 0 .4rem; font-size: 1rem; }
    .hero-art .tag { display: inline-block; background: color-mix(in lab, var(--accent), transparent 75%); border: 1px dashed var(--accent-strong); color: var(--accent); border-radius: .6rem; padding: .2rem .5rem; font-size: .8rem; }

    /* Quick entry */
    .quick { padding: 1rem 0 0; }
    .section-title { display: flex; align-items: baseline; justify-content: space-between; gap: 1rem; }
    .section-title h2 { margin: 0; font-size: clamp(1.35rem, 2.2vw, 1.8rem); }
    .cards { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 1rem; margin-top: .8rem; }

    /* Testimonials carousel */
    .testimonials { padding: 2rem 0; }
    .carousel { position: relative; background: var(--card); border: 1px solid var(--card-border); border-radius: 1rem; padding: 1rem; overflow: hidden; }
    .carousel__track { display: grid; grid-auto-flow: column; grid-auto-columns: 100%; transition: transform .5s ease; }
    .carousel__slide { padding: .5rem .2rem; }
    blockquote { margin: 0; font-size: 1.05rem; }
    .quote { color: var(--muted); }
    .cite { display: block; margin-top: .5rem; font-weight: 700; }
      .carousel__control { position: absolute; top: 50%; transform: translateY(-50%); border: 2px solid var(--accent); background: #fff; color: var(--accent); width: 40px; height: 40px; border-radius: 999px; display: grid; place-items: center; cursor: pointer; }
      .carousel__control:hover { background: color-mix(in srgb, var(--accent), #fff 90%); }
    .carousel__control.prev { left: .6rem; }
    .carousel__control.next { right: .6rem; }
    .dots { display: flex; gap: .4rem; justify-content: center; margin-top: .6rem; }
    .dot { width: 8px; height: 8px; border-radius: 999px; border: 1px solid var(--card-border); background: transparent; }
    .dot[aria-selected="true"] { background: var(--accent-strong); border-color: transparent; }

    /* Journey timeline */
    .journey { padding: 2rem 0; }
    .timeline { display: grid; gap: .8rem; }
    .steps { display: grid; grid-auto-flow: column; grid-auto-columns: min(260px, 90%); gap: .8rem; overflow-x: auto; scroll-snap-type: x mandatory; padding-bottom: .2rem; }
    /* step tiles: light green; active: darker green */
    .journey .step { scroll-snap-align: start; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 1rem; padding: 1rem; display: grid; gap: .4rem; color: #065f46; }
    .journey .step .index { font-weight: 800; color: var(--accent-strong); font-size: .9rem; }
    .journey .step p { color: #065f46; margin: 0; }
    .journey .step.active { background: #bbf7d0; border-color: var(--accent-strong); }

    /* Only cards inside the Journey section get green treatment; others use defaults */
    .journey .card { background: #f0fdf4; border: 1px solid #bbf7d0; color: #065f46; }

    /* Tools */
    .tools { padding: 2rem 0; }
    .tool-grid { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 1rem; }
    .tool { background: var(--card); border: 1px solid var(--card-border); border-radius: 1rem; padding: 1rem; display: grid; gap: .5rem; }
    .tool small { color: var(--muted); }

    /* Assessment */
    .assessment { padding: 2rem 0; }
    .assessment form { display: grid; grid-template-columns: 1.5fr 1fr auto; gap: .6rem; background: var(--card); border: 1px solid var(--card-border); border-radius: 1rem; padding: 1rem; }
    .assessment label { font-weight: 700; }
    .assessment select, .assessment input[type="text"] { width: 100%; border-radius: .6rem; border: 1px solid var(--card-border); background: var(--surface); color: var(--text); padding: .6rem .7rem; }

    /* Community */
    .community { padding: 2rem 0; }
    .callout { display: grid; grid-template-columns: 2.2fr 1fr; gap: 1rem; align-items: center; background: linear-gradient(135deg, color-mix(in lab, var(--accent), transparent 85%), transparent), var(--card); border: 1px solid var(--card-border); border-radius: 1rem; padding: 1rem; }
    .callout p { color: var(--muted); }

    /* Footer */
    .footer { margin-top: 2rem; background: var(--surface); border-top: 1px solid var(--card-border); }
    .footer .cols { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 1rem; padding: 1.4rem 0; }
    .footer a { color: var(--text); text-decoration: none; opacity: .9; }
    .footer a:hover { text-decoration: underline; }
    .small { color: var(--muted); font-size: .9rem; }

    /* Responsive */
    @media (max-width: 960px) {
      .hero-grid { grid-template-columns: 1fr; }
      .tool-grid, .cards, .footer .cols, .callout { grid-template-columns: 1fr; }
      .assessment form { grid-template-columns: 1fr; }
      nav[aria-label="Primary"] ul { gap: .4rem; flex-wrap: wrap; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { scroll-behavior: auto !important; animation-duration: .001ms !important; transition-duration: .001ms !important; }
    }
  </style>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <header class="site-header">
    <div class="container nav">
      <a class="logo" href="#" aria-label="NextChapter Home">
        <span class="logo-mark" aria-hidden="true">N</span> NextChapter
      </a>
      <nav aria-label="Primary">
        <ul>
          <li><a href="#journey">Your Journey</a></li>
          <li><a href="#tools">Services &amp; Tools</a></li>
          <li><a href="#resources">Resources</a></li>
          <li><a href="#community">Community</a></li>
          <li><a href="#about">About</a></li>
          <li><a class="btn btn-primary" href="#contact">Book a Session</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    <!-- Hero -->
    <section class="hero" role="region" aria-labelledby="hero-title">
      <div class="container hero-grid">
        <div>
          <h1 id="hero-title">Your Next Chapter Starts Here</h1>
          <p>Losing a job is tough. You don’t have to navigate it alone. We combine structure, empathy, and expert coaching aligned to your Jobs‑to‑Be‑Done journey.</p>
          <div class="actions">
            <a class="btn btn-primary" href="#assessment">Where are you in your journey?</a>
            <a class="btn btn-outline" href="#contact" aria-label="Book a coaching session">Book a Session</a>
          </div>
          <div class="kpi" aria-label="Program results">
            <div class="card" role="group" aria-label="Placement rate"><div class="num">82%</div><div class="lbl">placed within 6 months</div></div>
            <div class="card" role="group" aria-label="Coaching satisfaction"><div class="num">4.8/5</div><div class="lbl">coach satisfaction</div></div>
            <div class="card" role="group" aria-label="Average time to first interview"><div class="num">21 days</div><div class="lbl">to first interview</div></div>
          </div>
        </div>
        <aside class="hero-art" aria-label="Highlights">
          <div class="panel">
            <h3>Structured Roadmap</h3>
            <p class="small">From Stabilize → Transition with clear steps and checklists.</p>
            <span class="tag" aria-hidden="true">JTBD‑aligned</span>
          </div>
          <div class="panel">
            <h3>CV &amp; LinkedIn Lab</h3>
            <p class="small">AI + human feedback for a sharp market presence.</p>
          </div>
          <div class="panel">
            <h3>Resilience Support</h3>
            <p class="small">Tools to manage shock, shame, and uncertainty.</p>
          </div>
        </aside>
      </div>
    </section>

    <!-- Quick Entry -->
    <section class="quick container" aria-labelledby="quick-title">
      <div class="section-title">
        <h2 id="quick-title">Start where you are</h2>
        <a class="btn btn-outline" href="#journey">See full journey</a>
      </div>
      <div class="cards" role="list">
        <article class="card" role="listitem" id="stabilize">
          <h3>Stabilize &amp; Plan</h3>
          <p>ALV, health cover, severance &amp; pension, budget checklist.</p>
          <a class="btn" href="#journey">Go to step</a>
        </article>
        <article class="card" role="listitem" id="position">
          <h3>Rebuild &amp; Position</h3>
          <p>CV, LinkedIn, narrative. Tackle age bias with evidence.</p>
          <a class="btn" href="#tools">Open CV &amp; LinkedIn Lab</a>
        </article>
        <article class="card" role="listitem" id="apply">
          <h3>Explore &amp; Apply</h3>
          <p>Networking strategy, trackers, interview simulator.</p>
          <a class="btn" href="#tools">See tools</a>
        </article>
      </div>
    </section>

    <!-- Testimonials Carousel -->
    <section class="testimonials container" aria-labelledby="stories-title">
      <h2 id="stories-title">Real stories. Real momentum.</h2>
      <div class="carousel" data-carousel>
        <button class="carousel__control prev" aria-label="Previous testimonial" data-prev>‹</button>
        <div class="carousel__viewport" role="region" aria-roledescription="carousel" aria-label="Client testimonials">
          <ul class="carousel__track" data-track>
            <li class="carousel__slide" role="group" aria-roledescription="slide" aria-label="1 of 3">
              <blockquote>
                <p class="quote">“At 58 I feared I was ‘too late’. The structured journey and coaching rebuilt my confidence. I signed an offer in five months.”</p>
                <cite class="cite">— M., Operations Director</cite>
              </blockquote>
            </li>
            <li class="carousel__slide" role="group" aria-roledescription="slide" aria-label="2 of 3">
              <blockquote>
                <p class="quote">“The CV Lab and interview drills were game changers. I finally felt in control again.”</p>
                <cite class="cite">— M., Product Leader</cite>
              </blockquote>
            </li>
            <li class="carousel__slide" role="group" aria-roledescription="slide" aria-label="3 of 3">
              <blockquote>
                <p class="quote">“They understood the emotional side as much as the tactics. That balance made the difference.”</p>
                <cite class="cite">— A., Finance Manager</cite>
              </blockquote>
            </li>
          </ul>
        </div>
        <button class="carousel__control next" aria-label="Next testimonial" data-next>›</button>
        <div class="dots" role="tablist" aria-label="Select testimonial">
          <button class="dot" role="tab" aria-selected="true" aria-controls="t1" data-dot="0"></button>
          <button class="dot" role="tab" aria-selected="false" aria-controls="t2" data-dot="1"></button>
          <button class="dot" role="tab" aria-selected="false" aria-controls="t3" data-dot="2"></button>
        </div>
      </div>
    </section>

    <!-- Journey Overview -->
    <section class="journey container" id="journey" aria-labelledby="journey-title">
      <div class="section-title">
        <h2 id="journey-title">Your Journey</h2>
        <p class="small">Seven clear steps — from shock to a confident transition.</p>
      </div>
      <div class="timeline">
        <div class="steps" role="list">
          <article class="step active" role="listitem" id="step-stabilize">
            <div class="index">1 · Stabilize</div>
            <h3>Secure your foundation</h3>
            <p>ALV registration, health coverage, severance &amp; pension review, budgeting.</p>
            <a class="btn btn-outline" href="#resources">Checklists &amp; guides</a>
          </article>
          <article class="step" role="listitem" id="step-reframe">
            <div class="index">2 · Reframe</div>
            <h3>Reset &amp; define goals</h3>
            <p>Process shock, rebuild confidence, clarify constraints &amp; direction.</p>
            <a class="btn btn-outline" href="#community">Resilience hub</a>
          </article>
          <article class="step" role="listitem" id="step-position">
            <div class="index">3 · Position</div>
            <h3>Sharpen your market presence</h3>
            <p>Evidence‑led CV, LinkedIn optimization, narrative to counter age bias.</p>
            <a class="btn btn-outline" href="#tools">Open CV Lab</a>
          </article>
          <article class="step" role="listitem" id="step-explore">
            <div class="index">4 · Explore</div>
            <h3>Map the opportunity space</h3>
            <p>Hidden job market, recruiter strategy, market insights, salary ranges.</p>
            <a class="btn btn-outline" href="#tools">Market Explorer</a>
          </article>
          <article class="step" role="listitem" id="step-apply">
            <div class="index">5 · Apply</div>
            <h3>Engage with intent</h3>
            <p>Tailored applications, trackers, interview rehearsal &amp; feedback.</p>
            <a class="btn btn-outline" href="#tools">Interview Simulator</a>
          </article>
          <article class="step" role="listitem" id="step-secure">
            <div class="index">6 · Secure</div>
            <h3>Negotiate &amp; sign</h3>
            <p>Offer evaluation, terms, start dates, counter‑offers, decision clarity.</p>
            <a class="btn btn-outline" href="#resources">Negotiation scripts</a>
          </article>
          <article class="step" role="listitem" id="step-transition">
            <div class="index">7 · Transition</div>
            <h3>First 90 days</h3>
            <p>Onboarding plan, quick wins, expectations alignment, energy balance.</p>
            <a class="btn btn-outline" href="#resources">90‑day plan</a>
          </article>
        </div>
      </div>
    </section>

    <!-- Tools -->
    <section class="tools container" id="tools" aria-labelledby="tools-title">
      <div class="section-title">
        <h2 id="tools-title">Services &amp; Tools</h2>
        <a class="btn btn-outline" href="#contact">Talk to a coach</a>
      </div>
      <div class="tool-grid">
        <article class="tool">
          <h3>CV &amp; LinkedIn Lab</h3>
          <small>AI + Coach Feedback</small>
          <p class="small">Upload, get structured suggestions, and iterate live with a coach.</p>
          <a class="btn" href="#">Start now</a>
        </article>
        <article class="tool">
          <h3>Application Tracker</h3>
          <small>Keep momentum</small>
          <p class="small">A simple CRM for roles, contacts, and follow‑ups — all in one place.</p>
          <a class="btn" href="#">Open tracker</a>
        </article>
        <article class="tool">
          <h3>Interview Simulator</h3>
          <small>Practice &amp; feedback</small>
          <p class="small">Rehearse senior‑level prompts, get targeted feedback and next actions.</p>
          <a class="btn" href="#">Start a session</a>
        </article>
        <article class="tool">
          <h3>Market Explorer</h3>
          <small>Insight advantage</small>
          <p class="small">Industry trends, salary ranges, and hidden job market strategies.</p>
          <a class="btn" href="#">Explore now</a>
        </article>
        <article class="tool">
          <h3>Skill Booster</h3>
          <small>Short, curated courses</small>
          <p class="small">Fill capability gaps fast: digital fluency, leadership refreshers, PM.</p>
          <a class="btn" href="#">Browse catalog</a>
        </article>
        <article class="tool">
          <h3>1:1 Coaching</h3>
          <small>Personal support</small>
          <p class="small">Go deep on tactics and mindset with an experienced coach.</p>
          <a class="btn" href="#contact">Book now</a>
        </article>
      </div>
    </section>

    <!-- Assessment Widget -->
    <section class="assessment container" id="assessment" aria-labelledby="assessment-title">
      <h2 id="assessment-title">Find your next best step</h2>
      <form id="assessment-form" aria-describedby="assessment-help">
        <label for="stage">I’m currently at</label>
        <select id="stage" name="stage">
          <option value="step-stabilize">Stabilize</option>
          <option value="step-reframe">Reframe</option>
          <option value="step-position">Position</option>
          <option value="step-explore">Explore</option>
          <option value="step-apply">Apply</option>
          <option value="step-secure">Secure</option>
          <option value="step-transition">Transition</option>
        </select>
        <button class="btn btn-primary" type="submit">Show my step</button>
        <p id="assessment-help" class="small">We’ll scroll you to the matching section with relevant tools and guides.</p>
      </form>
    </section>

    <!-- Community & Support -->
    <section class="community container" id="community" aria-labelledby="community-title">
      <div class="callout">
        <div>
          <h2 id="community-title">You’re not alone in this</h2>
          <p>Join group coaching, learn from peers 50+, and access the resilience hub for practical exercises to manage shock, shame, and uncertainty.</p>
          <div class="actions">
            <a class="btn btn-primary" href="#">Join the community</a>
            <a class="btn btn-outline" href="#">Read peer stories</a>
          </div>
        </div>
        <div aria-hidden="true" class="panel" style="min-height: 160px; display: grid; place-items: center; border-radius: .8rem; background: var(--card); border: 1px solid var(--card-border);">
          <div>
            <div style="font-weight:800; font-size: 2rem; text-align:center;">58 → Hired</div>
            <div class="small" style="text-align:center;">A typical client journey</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Resources Teaser -->
    <section class="container" id="resources" aria-labelledby="resources-title" style="padding: 2rem 0;">
      <div class="section-title">
        <h2 id="resources-title">Guides &amp; Templates</h2>
        <a class="btn btn-outline" href="#resources-all">Browse all</a>
      </div>
      <div class="cards" role="list">
        <article class="card" role="listitem">
          <h3>Financial Checklist (ALV, Health, Pension)</h3>
          <p class="small">A step‑by‑step list to stabilize the essentials in week 1–2.</p>
          <a class="btn" href="#">Download PDF</a>
        </article>
        <article class="card" role="listitem">
          <h3>Negotiation Scripts</h3>
          <p class="small">Evaluate offers, counter with confidence, close with clarity.</p>
          <a class="btn" href="#">Download</a>
        </article>
        <article class="card" role="listitem">
          <h3>90‑Day Transition Plan</h3>
          <p class="small">Onboarding playbook for the first three months.</p>
          <a class="btn" href="#">Get the plan</a>
        </article>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer" id="contact" role="contentinfo" aria-labelledby="footer-title">
    <div class="container cols">
      <section aria-labelledby="footer-title">
        <h3 id="footer-title">NextChapter</h3>
        <p class="small">Professional outplacement for experienced talent. Human, efficient, JTBD‑aligned.</p>
      </section>
      <section>
        <h3>Explore</h3>
        <ul>
          <li><a href="#journey">Your Journey</a></li>
          <li><a href="#tools">Services &amp; Tools</a></li>
          <li><a href="#resources">Resources</a></li>
        </ul>
      </section>
      <section>
        <h3>Company</h3>
        <ul>
          <li><a href="#about">About</a></li>
          <li><a href="#community">Community</a></li>
          <li><a href="#">Privacy</a></li>
        </ul>
      </section>
      <section>
        <h3>Contact</h3>
        <ul>
          <li><a href="mailto:hello@nextchapter.example">hello@nextchapter.example</a></li>
          <li><a href="tel:+41000000000">+41 00 000 00 00</a></li>
          <li><a href="#">Book a session</a></li>
        </ul>
      </section>
    </div>
    <div class="container" style="padding-bottom: 1.2rem;">
      <p class="small">© <span id="year"></span> NextChapter AG. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Basic carousel logic (accessible)
    (function(){
      const root = document.querySelector('[data-carousel]');
      if (!root) return;
      const track = root.querySelector('[data-track]');
      const slides = Array.from(track.children);
      const prev = root.querySelector('[data-prev]');
      const next = root.querySelector('[data-next]');
      const dots = Array.from(root.querySelectorAll('[data-dot]'));
      let index = 0;

      function go(i){
        index = (i + slides.length) % slides.length;
        track.style.transform = `translateX(-${index * 100}%)`;
        dots.forEach((d, di) => d.setAttribute('aria-selected', di === index ? 'true' : 'false'));
      }

      prev.addEventListener('click', () => go(index - 1));
      next.addEventListener('click', () => go(index + 1));
      dots.forEach(d => d.addEventListener('click', e => go(parseInt(e.currentTarget.dataset.dot, 10))));

      // Keyboard support
      root.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') go(index - 1);
        if (e.key === 'ArrowRight') go(index + 1);
      });

      // Auto-advance (reduced motion aware)
      const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      if (!mq.matches) {
        setInterval(() => go(index + 1), 6000);
      }
    })();

    // Assessment navigation + dynamic active state in Journey
    (function(){
      const form = document.getElementById('assessment-form');
      const steps = Array.from(document.querySelectorAll('.journey .step'));
      function setActive(id){
        steps.forEach(s => s.classList.toggle('active', s.id === id));
      }
      if (form) {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          const value = document.getElementById('stage').value;
          const el = document.getElementById(value);
          if (el) {
            setActive(value);
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            el.classList.add('pulse');
            setTimeout(() => el.classList.remove('pulse'), 1200);
          } else {
            location.hash = value;
          }
        });
      }
    })();
  </script>
  <style>
    /* Small pulse to highlight scrolled-to element */
    .pulse { box-shadow: 0 0 0 3px color-mix(in lab, var(--accent-strong), transparent 50%), var(--shadow); transition: box-shadow .6s ease; }
  </style>
  
  
  <!-- JTBD Journey Coach: Floating button + slide-over panel -->
  <button id="coach-fab" class="coach-fab" aria-controls="coach-panel" aria-expanded="false" aria-label="Open Journey Coach">Journey Coach</button>
  
  <aside id="coach-panel" class="coach-panel" aria-hidden="true" role="dialog" aria-labelledby="coach-title">
    <header class="coach-header">
      <h3 id="coach-title">JTBD Journey Coach</h3>
      <button id="coach-close" class="coach-close" aria-label="Close">✕</button>
    </header>

    <form id="coach-form" class="coach-form" aria-describedby="coach-help">
      <label for="coach-phase">Phase</label>
      <select id="coach-phase" name="coach-phase">
        <option value="stabilize">Stabilize</option>
        <option value="reframe">Reframe</option>
        <option value="position" selected>Position</option>
        <option value="explore">Explore</option>
        <option value="apply">Apply</option>
        <option value="secure">Secure</option>
        <option value="transition">Transition</option>
      </select>

      <label for="coach-week">Week in phase</label>
      <input id="coach-week" name="coach-week" type="number" min="1" value="1" />

      <label for="coach-note">Context (optional)</label>
      <textarea id="coach-note" name="coach-note" rows="3" placeholder="Anything you'd like me to account for this week (constraints, targets, mood, obstacles)"></textarea>

      <div class="coach-actions">
        <button class="btn btn-primary" data-kind="plan" type="button">Weekly Plan</button>
        <button class="btn" data-kind="standup" type="button">Daily Stand‑up</button>
        <button class="btn" data-kind="gate" type="button">Phase Gate Review</button>
        <button class="btn" data-kind="triage" type="button">Setback Triage</button>
      </div>
      <p id="coach-help" class="small">The coach generates structured instructions. It doesn’t search jobs; it guides your process.</p>
    </form>

    <section class="coach-output" aria-live="polite" aria-busy="false">
      <div id="coach-output" class="coach-pre" role="document" tabindex="0">Your plan will appear here…</div>
      <div class="coach-footer">
        <button id="coach-copy" class="btn btn-outline" type="button">Copy to clipboard</button>
      </div>
    </section>
  </aside>

  <style>
    .coach-fab { position: fixed; right: 24px; bottom: 24px; z-index: 120; border: none; border-radius: 999px; padding: .9rem 1.1rem; cursor: pointer; box-shadow: var(--shadow); background: linear-gradient(135deg, var(--accent), var(--accent-strong)); color: #0b1320; font-weight: 750; }
    .coach-panel { position: fixed; top: 0; right: 0; height: 100%; width: min(520px, 94vw); background: var(--surface); border-left: 1px solid var(--card-border); box-shadow: var(--shadow); transform: translateX(100%); transition: transform .3s ease; z-index: 110; display: grid; grid-template-rows: auto auto 1fr; }
    .coach-panel.open { transform: translateX(0); }
    .coach-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid var(--card-border); }
    .coach-close { background: transparent; border: 1px solid var(--card-border); color: var(--text); border-radius: .6rem; padding: .3rem .6rem; cursor: pointer; }
    .coach-form { display: grid; grid-template-columns: 1fr 1fr; gap: .8rem; padding: 1rem; border-bottom: 1px solid var(--card-border); }
    .coach-form label { grid-column: span 2; font-weight: 700; }
    .coach-form select, .coach-form input[type="number"], .coach-form textarea { width: 100%; border-radius: .6rem; border: 1px solid var(--card-border); background: var(--card); color: var(--text); padding: .6rem .7rem; }
    .coach-form #coach-phase, .coach-form #coach-week { grid-column: span 1; }
    .coach-form #coach-note { grid-column: span 2; }
    .coach-actions { grid-column: span 2; display: flex; gap: .6rem; flex-wrap: wrap; }
    .coach-output { display: grid; grid-template-rows: 1fr auto; padding: 1rem; min-height: 0; }
    .coach-pre { margin: 0; white-space: normal; background: var(--card); border: 1px solid var(--card-border); border-radius: .8rem; padding: 1rem; min-height: 200px; overflow: auto; max-height: 60vh; }
    .coach-footer { display: flex; justify-content: flex-end; gap: .6rem; padding-top: .6rem; }
    @media (max-width: 960px) { .coach-form { grid-template-columns: 1fr; } .coach-form #coach-phase, .coach-form #coach-week { grid-column: span 1; } }
  </style>

  <script>
    (function(){
      const API_BASE = "/"; // If your Flask app runs elsewhere, e.g. "http://localhost:5055/"
      const ENDPOINTS = { plan: "plan", standup: "standup", gate: "gate", triage: "triage" };

      const fab = document.getElementById('coach-fab');
      const panel = document.getElementById('coach-panel');
      const closeBtn = document.getElementById('coach-close');
      const form = document.getElementById('coach-form');
      const out = document.getElementById('coach-output');
      const copyBtn = document.getElementById('coach-copy');

      function openPanel(){ panel.classList.add('open'); panel.setAttribute('aria-hidden','false'); fab.setAttribute('aria-expanded','true'); }
      function closePanel(){ panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); fab.setAttribute('aria-expanded','false'); }

      fab.addEventListener('click', openPanel);
      closeBtn.addEventListener('click', closePanel);

      panel.addEventListener('click', (e) => { if (e.target === panel) closePanel(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closePanel(); });

      function setActiveFromPhase(phase){
        const id = `step-${phase}`; // e.g., step-stabilize
        document.querySelectorAll('.journey .step').forEach(s => s.classList.remove('active'));
        const el = document.getElementById(id);
        if (el){ el.classList.add('active'); el.scrollIntoView({behavior:'smooth', block:'nearest'}); }
      }

      async function callCoach(kind){
        const phase = document.getElementById('coach-phase').value;
        const week = parseInt(document.getElementById('coach-week').value || '1', 10);
        const note = document.getElementById('coach-note').value;

        const body = {
          user_state: {
            current_phase: phase,
            week_in_phase: week
          },
          note: note
        };
        out.textContent = 'Generating…';
        panel.querySelector('.coach-output').setAttribute('aria-busy','true');
        try {
          const res = await fetch(`${API_BASE}${ENDPOINTS[kind]}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          });
          if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
          const data = await res.json();
          try { out.innerHTML = DOMPurify.sanitize(marked.parse(data.reply || 'No content.')); } catch (e) { out.textContent = data.reply || 'No content.'; } out.scrollTop = out.scrollHeight;
          setActiveFromPhase(phase);
        } catch (err) {
          out.textContent = `Error: ${err.message}.
Check that the Flask API is running and API_BASE is correct.`;
        } finally {
          panel.querySelector('.coach-output').setAttribute('aria-busy','false');
        }
      }

      form.querySelectorAll('[data-kind]').forEach(btn => {
        btn.addEventListener('click', () => callCoach(btn.dataset.kind));
      });

      copyBtn.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(out.textContent); copyBtn.textContent = 'Copied!'; setTimeout(()=>copyBtn.textContent='Copy to clipboard', 1200); } catch {}
      });
    })();
  </script>

</body>
</html>
